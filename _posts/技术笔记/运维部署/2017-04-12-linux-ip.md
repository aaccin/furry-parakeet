---
title: 检测端口和快速查询出网 ip
date: 2017-04-12 18:00:41
tags: [linux]
---

## 方法一

场景:A 端对某区域 B 端 的 ip 段开放权限,对方又无法告知出网 ip

### A 端开启端口

```
    nc -l 8888
```

### B 端访问端口

```
    telnet A_IP 8888
```

### A 端查看连接的 IP

```
    ss -an | grep 8888
```

## 方法二

```
curl ident.me
```

```
什么是nc
nc是netcat的简写，有着网络界的瑞士军刀美誉。因为它短小精悍、功能实用，被设计为一个简单、可靠的网络工具

nc的作用
（1）实现任意TCP/UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口
（2）端口的扫描，nc可以作为client发起TCP或UDP连接
（3）机器之间传输文件
（4）机器之间网络测速
nc的控制参数不少，常用的几个参数如下所列：
1) -l
用于指定nc将处于侦听模式。指定该参数，则意味着nc被当作server，侦听并接受连接，而非向其它地址发起连接。
2) -p <port>
暂未用到（老版本的nc可能需要在端口号前加-p参数，下面测试环境是centos6.6，nc版本是nc-1.84，未用到-p参数）
3) -s
指定发送数据的源IP地址，适用于多网卡机
4) -u
 指定nc使用UDP协议，默认为TCP
5) -v
输出交互或出错信息，新手调试时尤为有用
6）-w
超时秒数，后面跟数字
7）-z
表示zero，表示扫描时不发送任何数据

nc用法1，网络连通性测试和端口扫描
nc可以作为server端启动一个tcp的监听（注意，此处重点是起tcp，下面还会讲udp）
先关闭A的防火墙，或者放行下面端口，然后测试B机器是否可以访问A机器启动的端口
在A机器上启动一个端口监听，比如 9999端口（注意：下面的-l 是小写的L，不是数字1）
默认情况下下面监听的是一个tcp的端口
nc -l 9999

nc用法2，使用nc传输文件和目录
方法1，传输文件演示（先启动接收命令）
使用nc传输文件还是比较方便的，因为不用scp和rsync那种输入密码的操作了
把A机器上的一个rpm文件发送到B机器上
需注意操作次序，receiver先侦听端口，sender向receiver所在机器的该端口发送数据。

步骤1，先在B机器上启动一个接收文件的监听，格式如下
意思是把赖在9995端口接收到的数据都写到file文件里（这里文件名随意取）
nc -l port >file
nc -l 9995 >zabbix.rpm
步骤2，在A机器上往B机器的9995端口发送数据，把下面rpm包发送过去
nc 10.0.1.162 9995 < zabbix-release-2.4-1.el6.noarch.rpm

方法3，传输目录演示（方法发送文件类似）

步骤1，B机器先启动监听，如下
A机器给B机器发送多个文件
传输目录需要结合其它的命令，比如tar
经过我的测试管道后面最后必须是 - ，不能是其余自定义的文件名
nc -l 9995 | tar xfvz -

步骤2，A机器打包文件并连接B机器的端口
管道前面表示把当前目录的所有文件打包为 - ，然后使用nc发送给B机器
tar cfz - * | nc 10.0.1.162 9995

nc用法3，测试网速
测试网速其实利用了传输文件的原理，就是把来自一台机器的/dev/zero 发送给另一台机器的/dev/null
就是把一台机器的无限个0，传输给另一个机器的空设备上，然后新开一个窗口使用dstat命令监测网速
在这之前需要保证机器先安装dstat工具
yum install -y dstat

方法1，测试网速演示（先启动接收命令方式）
步骤1，A机器先启动接收数据的命令，监听自己的9991端口，把来自这个端口的数据都输出给空设备（这样不写磁盘，测试网速更准确）
nc -l 9991 >/dev/null

步骤2，B机器发送数据，把无限个0发送给A机器的9991端口
nc 10.0.1.161 9991 </dev/zero

```
