---
title: SY部署笔记
date: 2017-11-22 04:03:30
tags: [linux]
---

## 搭建环境

* CentOS release 6.9 (Final) GNU/Linux
* Nginx
* PHP：5.6
* Twemproxy

<!-- more -->

### ulimit

```
vim /etc/profile

ulimit -u 1000000
ulimit -n 1000000
ulimit -d unlimited
ulimit -m unlimited
ulimit -s unlimited
ulimit -t unlimited
ulimit -v unlimited

source /etc/profile
```

### timezone
```
yum install ntp //安装ntp服务
systemctl enable ntpd //开机启动服务
systemctl start ntpd //启动服务
timedatectl set-timezone Asia/Shanghai //更改时区
timedatectl set-ntp yes //启用ntp同步
ntpq -p //同步时间
```


## path

```
    mkdir -p /app/local/php/ /app/local/nginx/ /app/data /app/log /app/src /app/log/php-fpm/ /var/run/php-fpm/
    
    ## Fedora centos
    yum update
    yum group install "Development Tools"
    
    ## Debian / Ubuntu / Debian derivatives
    apt-get install build-essential
```

## Nginx - tengine

````
    useradd nginx    
    
    ## Fedora centos
    yum -y install pcre-devel openssl openssl-devel
    
    ## Debian / Ubuntu / Debian derivatives
    apt-get install libpcre3 libpcre3-dev openssl libssl-dev
    
    wget http://tengine.taobao.org/download/tengine-2.2.1.tar.gz
    tar zxvf tengine-2.2.1.tar.gz
    cd tengine-2.2.1
    ./configure --prefix=/app/local/nginx
    make && make install 
    
````

## Php5.6

````
    useradd gouser

    yum install -y libpng-devel libjpeg-devel libcurl-devel gmp-devel openssl-devel libmcrypt-devel mhash-devel mysql-devel bzip2-devel libmcrypt.x86_64 libmcrypt-devel.x86_64 libxml2-devel

    wget -O php56.tar.gz http://t.cn/RYhCskQ
    tar -zxvf php56.tar.gz

    cd php-5.6.31/
    
    ./configure \
    --prefix=/app/local/php/ \
    --with-config-file-path=/etc/ \
    --with-config-file-scan-dir=/etc/php.d/ \
    --with-pdo-mysql \
    --with-mysql \
    --with-mysqli \
    --with-bz2 \
    --with-curl \
    --with-gd \
    --with-gettext \
    --with-gmp \
    --with-mhash \
    --with-mcrypt \
    --with-iconv \
    --with-openssl \
    --with-png-dir \
    --with-jpeg-dir \
    --enable-fpm \
	 --enable-bcmath \
	 --enable-exif \
	 --enable-mbstring \
    --enable-soap \
    --enable-sockets \
    --enable-calendar \
    --disable-fileinfo 
    
    make && make install
    make clean
    
    ## 设置软连接
    ln -s /app/local/php/bin/* /usr/local/bin/
    touch /var/run/php-fpm/php-fpm.pid

    ## install swoole
    wget -O swoole1.9.22.tar.gz https://github.com/swoole/swoole-src/archive/v1.9.22.tar.gz

    tar -zxvf swoole1.9.22.tar.gz
    cd swoole-src-1.9.22
    phpize
    ./configure --enable-openssl
    make && make install

    ## install phalcon
    yum install -y php-devel pcre-devel gcc make re2c
    git clone git://github.com/phalcon/cphalcon.git
    cd cphalcon/build
    ./install

    ## install beehive
    git clone https://github.com/shouyintv/beehive-php-ext.git
    phpize
     ./configure
    make && make install

    ## install redis
    wget -O phpredis3.1.4.tar.gz https://github.com/phpredis/phpredis/archive/3.1.4.tar.gz
    tar -zxvf phpredis3.1.4.tar.gz
    cd phpredis-3.1.4
    phpize
    ./configure
    make && make install

    ## install mysql-pdo
    pecl install pdo

    ## php.ini
    cd /etc
    wget -O phpconfig.zip http://attachment.shouyintv.cn/Z1EtMPO
    
    ### composer
    cd /app/data/php/
    php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
    php composer-setup.php
    php -r "unlink('composer-setup.php');"
    
    ln -s /app/data/php/composer.phar /usr/local/bin/composer
    
````



### other php ext for php5.6
apcu - wget http://pecl.php.net/get/apcu-4.0.8.tgz
Core
ctype
curl
date
dom
ereg
exif
fileinfo
filter
ftp
gd
gettext
gmp
hash
iconv
intl
json
libxml
mbstring
mcrypt
mhash
mongo
mysql
mysqli
mysqlnd
openssl
pcntl
pcre
PDO
pdo_mysql
PDO_ODBC
pdo_sqlite
phalcon
Phar
posix
protobuf
pspell
readline
recode
redis
Reflection
session
shmop
SimpleXML
SnakeBrother
snmp
soap
sockets
SPL
sqlite3
standard
swoole
sysvmsg
sysvsem
sysvshm
tidy
tokenizer
wddx
xml
xmlreader
xmlrpc
xmlwriter
xsl
zip
zlib



netstat -plnt

